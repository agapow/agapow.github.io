<!doctype html>
<html lang="">
<head>
	<meta charset="utf-8"/>
	<title>More things I done learned about Galaxy tool development - Make More Machines</title>
	<meta name="author" content="Paul Agapow">


  <meta name="description" content="More things I done learned about Galaxy tool development A pot-pouri of titbits that are probably documented somewhere, but weren't obvious to me. Labels on the tool menu You can't nest sections on the tool panel - but you can put labels in sections for the same effect. Look at tool_conf …">

	<meta name="twitter:card" content="summary">
	  <meta name="twitter:creator" content="@agapow">
	<meta name="twitter:title" content="More things I done learned about Galaxy tool development">
	<meta name="twitter:description" content="More things I done learned about Galaxy tool development A pot-pouri of titbits that are probably documented somewhere, but weren't obvious to me. Labels on the tool menu You can't nest sections on the tool panel - but you can put labels in sections for the same effect. Look at tool_conf …">
	<meta name="twitter:url" content="/science/computational-biology/galaxy/more-things-i-done-learned-about-galaxy-tool-development/">


	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />



</head>

<body>

    <div class="container">

	  <header role="banner">
	    <div class="feeds">
	    </div>
	      <nav class="pages">
			  <a href="/about">About</a>
-			  <a href="/whereabouts">Whereabouts</a>
	      </nav>
		<a href="" class="title">Make More Machines</a>&nbsp;&nbsp;(agapow.net)
      </header>

	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">

		<h1>More things I done learned about Galaxy tool development</h1>

<div class="metadata">
  <time datetime="2012-01-01T12:00:00+00:00" pubdate>2012-01-01</time>
    <address class="vcard author">
      by <a class="url fn" href="/False">Paul Agapow</a>
    </address>
  in <a href="/science/">science</a>
<p class="tags">tagged <a href="//by-tag/computational-biology/">computational biology</a>, <a href="//by-tag/galaxy/">galaxy</a></p></div>


      <p><em>More things I done learned about Galaxy tool development</em></p>
<p>A pot-pouri of titbits that are probably documented somewhere, but
weren't obvious to me.</p>
<div class="section" id="labels-on-the-tool-menu">
<h2>Labels on the tool menu</h2>
<p>You can't nest sections on the tool panel - but you can put labels in
sections for the same effect. Look at tool_conf.xml and the <em>NGS: QC
and manipulation</em> section for an example. Labels looks like a single
closed tag:</p>
<pre class="literal-block">
&lt;label text=&quot;Illumina data&quot; id=&quot;illumina&quot; /&gt;
</pre>
</div>
<div class="section" id="more-advanced-options">
<h2>More / advanced options</h2>
<p>The fasta groomer tool is a good demo of how to implement a dropdown to
expose or hide extra options for a tool. To summarize, in your
parameters have a conditional section with a selector and then a when
for the values of the selector:</p>
<pre class="literal-block">
&lt;option value=&quot;more&quot;&gt;More options&lt;/option&gt;
&lt;/param&gt;
&lt;when value=&quot;less&quot;&gt;
&lt;!-- no options --&gt;
&lt;/when&gt;
&lt;when value=&quot;advanced&quot;&gt; # many parameters &lt;/when&gt;
&lt;/conditional&gt;
</pre>
</div>
<div class="section" id="file-formats">
<h2>File formats</h2>
<p>The correct file format for text files is txt (no 'e'). Interesting, you
can give a file a bogus or incorrect format (e.g. format=&quot;fsta&quot;) and no
error is generated. The only apparant symptom is that when you click on
the eye icon to view the file, it downloads instead.</p>
</div>
<div class="section" id="errors-in-the-tool-config-file">
<h2>Errors in the tool config file</h2>
<p>Curiously, not all errors in individual tool config file are picked up.
I had a situation where I'd failed to nest &lt;configfile&gt; correctly inside
&lt;configfiles&gt; and no error was signaled: the element just wasn't used.
So beware: just because Galaxy doesn't complain about the file, doesn't
mean it's right.</p>
</div>
<div class="section" id="config-files">
<h2>Config files</h2>
<p>These are very useful ... just not always for the things you might
imagine.</p>
<p>A config file is unfortunately named, because it actually means a file
that that is generated by the tool config file. You can't set the name
of a config file (e.g. to &quot;myprog.cfg&quot;) to a hardcoded name that is
expected by your executable - It will be something arbitrary. Therefore
the config must be passed on the commandline line. In effect, it's
another input file, just one that is generated for that invocation of
the tool.</p>
<p>Which brings us to a wider issue in Galaxy tool development: passing
parameters. The need to pass all in- and out- file names to a Galaxy
tool means that your commandline can get astonishingly overloaded, you
have to write parsing code to sort the options out, it all becomes more
complicated than it should be. Config files offer a quick way around all
this mess. The below example uses ruby, but variants will be possible in
most other scripting languages.</p>
<ol class="arabic simple">
<li>In the tool config file, dump all the parameters, file names etc. into a config file, in the form of a hash:</li>
</ol>
<blockquote>
<pre class="literal-block">
&lt;configfile name=&quot;gene_finder_cfg&quot;&gt;
# arguments for the gene_finder script
args = {
 :input_files =&gt; [ #for $in_seq in $input_seq_files { :path =&gt; &quot;$in_seq.in&quot;, :title =&gt; &quot;$in_seq.in.name&quot;, }, #end for ], :ref_files =&gt; [ #for $ref_seq in $ref_seq_files { :path =&gt; &quot;$ref_seq.in&quot;, :title =&gt; &quot;$ref_seq.in.name&quot;, }, #end for ], ... }
</pre>
</blockquote>
<ol class="arabic simple">
<li>Also write the tool commandline, so as to pass the config file path</li>
</ol>
<blockquote>
<pre class="literal-block">
&lt;command interpreter=&quot;ruby&quot;&gt; gene_finder.rb $gene_finder_cfg &lt;/command&gt;
</pre>
</blockquote>
<ol class="arabic simple">
<li>In the script, grab the config file and read it and evaluate it:</li>
</ol>
<blockquote>
<pre class="literal-block">
config_file = ARGV[0] options = eval (File.read (config_file))
</pre>
</blockquote>
<p>All your parameters are now in &quot;options&quot;. Easy.</p>
</div>
<div class="section" id="tabular-data">
<h2>Tabular data</h2>
<p>Must be uploaded as .tsv, i.e. will tab seperated columns. Galaxy
doesn't understand CSV.</p>
</div>
<div class="section" id="reference-data">
<h2>Reference data</h2>
<p>Many tools will require reference data: long lasting data that is not
analysed itself, but is used in the analysis of other data, changes
infrequently and is usually shared. While there's some clear mechanisms
for some of the genomic tools, the general idiom for new sorts of
reference data is unclear. Two obvious mechanisms suggest themselves:</p>
<ul class="simple">
<li>Hardcode it into the tool and put a file reference data in the tool data directory. But this means that the tool can only use one reference (e.g. not one from a selection). Updating means replacing the datafile - easy but no change is propagated to the user.</li>
<li>Alternatively, you could just unload the reference file, and share it. This would allow the existence of multiple reference files to be chosen from (<em>I need to run this against the E. coli set not the yeast one</em>) and for easy updates and explicit versioning (<em>v Nov 2011</em>). It may prove useful semantically to subtype the tables.</li>
</ul>
</div>
<div class="section" id="repeating-inputs">
<h2>Repeating inputs</h2>
<p>Repeating (i.e. a variable number of) inputs can easily be configured
like so:</p>
<pre class="literal-block">
&lt;inputs&gt; &lt;repeat name=&quot;maf_filters&quot; title=&quot;Filter&quot;&gt; &lt;param name=&quot;in&quot; type=&quot;data&quot; format=&quot;maf&quot; label=&quot;MAF File&quot;/&gt; &lt;/repeat&gt; &lt;/inputs&gt;
</pre>
<p>That is, a variable number of MAF files are selected as inputs. Where an
easy mistake can be made is when configuring the commandline. You might
do this:</p>
<pre class="literal-block">
&lt;command&gt; myawesomescript #for $m in $maf_filters: $m #end if &lt;/command&gt;
</pre>
<p>This will generate an uninformative error message. The problem is that
$m is the value for the repeat interation or loop. To get at the param,
you have to qualify it with the name of the param:</p>
<pre class="literal-block">
&lt;command&gt; myawesomescript #for $m in $maf_filters: $m.in #end if &lt;/command&gt;
</pre>
<p>The reason for this is more obvious when you are looping over multiple
things:</p>
<pre class="literal-block">
&lt;inputs&gt; &lt;repeat name=&quot;maf_filters&quot; title=&quot;Filter&quot;&gt; &lt;param name=&quot;in&quot; type=&quot;data&quot; format=&quot;maf&quot; label=&quot;MAF File&quot;/&gt; &lt;param name=&quot;in_foo&quot; type=&quot;text&quot; label=&quot;What foo value?&quot; value=&quot;bar&quot;/&gt; &lt;/repeat&gt; &lt;/inputs&gt;
</pre>
</div>


	</article>

    <p>
	<a href="https://twitter.com/share" class="twitter-share-button" data-via="" data-lang="en" data-size="large" data-related="">Tweet</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	</p>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'agapow';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

		  </div>

		  <div class="sidebar">
		    <div class="sidebar-container" >


	            <aside>
	              <h2>About</h2>
			      <p class='summary'>
                  This site has just been restored, with most of the content
						translated automatically from its old form. Expect bugs,
						missing information and general wierdness as things
						get sorted out.
			      </p>
			    </aside>


  	          <nav>
	            <h2>Categories</h2>
	            <ul>
	                <li ><a href="/misc/">misc</a></li>
	                <li ><a href="/personal/">personal</a></li>
	                <li ><a href="/programming/">programming</a></li>
	                <li ><a href="/publications/">publications</a></li>
	                <li class="active"><a href="/science/">science</a></li>
	                <li ><a href="/software/">software</a></li>
	                <li ><a href="/talks/">talks</a></li>
	            </ul>

	            <ul>
	              <li><a href="/tags.html">all tags</a></li>
	            </ul>
	          </nav>

	            <aside>
	            <h2>Social</h2>
			      <ul class="social">
				    <li><a href="http://twitter.com/agapow">Twitter</a><i></i></li>
				    <li><a href="http://github.com/agapow">Github</a><i></i></li>
				    <li><a href="https://plus.google.com/u/0/113920832845886210876/posts">Google+</a><i></i></li>
				    <li><a href="http://uk.linkedin.com/pub/paul-michael-agapow/2/15b/184/">linkedIn</a><i></i></li>
			      </ul>
			    </aside>

	            <aside>
	              <h2>Links</h2>
	              <ul>
	                  <li><a href="http://www.imperial.ac.uk/data-science/">IC Data Science Institute</a></li>
	                  <li><a href="http://www.meetup.com/Bioinformatics-London">Bioinformatics London</a></li>
	              </ul>
	            </aside>

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/agapow" data-widget-id="336428520026812416">Tweets by @agapow</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

	        </div>
		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  Paul Agapow - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-sober">pelican-sober</a>.
    	</p>

	  </footer>

	</div>


</body>
</html>