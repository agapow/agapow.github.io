<!doctype html>
<html lang="">
<head>
	<meta charset="utf-8"/>
	<title>Django form fields - Make More Machines</title>
	<meta name="author" content="Paul Agapow">


  <meta name="description" content="Django's form generation machinery for the most part is fine and straightforward, but on a recent project I ran into problems with a form that accepted files. The documentation is all there, but changes in how things work and an emphasis on forms for models make things harder to understand …">

	<meta name="twitter:card" content="summary">
	  <meta name="twitter:creator" content="@agapow">
	<meta name="twitter:title" content="Django form fields">
	<meta name="twitter:description" content="Django's form generation machinery for the most part is fine and straightforward, but on a recent project I ran into problems with a form that accepted files. The documentation is all there, but changes in how things work and an emphasis on forms for models make things harder to understand …">
	<meta name="twitter:url" content="/programming/web-development/django-form-fields/">


	<link rel="stylesheet" href="/theme/css/main.css" type="text/css" />



</head>

<body>

    <div class="container">

	  <header role="banner">
	    <div class="feeds">
	    </div>
	      <nav class="pages">
			  <a href="/about">About</a>
-			  <a href="/whereabouts">Whereabouts</a>
	      </nav>
		<a href="" class="title">Make More Machines</a>&nbsp;&nbsp;(agapow.net)
      </header>

	  <div class="wrapper">

		  <div role="main" class="content">
	<article class="full">

		<h1>Django form fields</h1>

<div class="metadata">
  <time datetime="2012-05-14T12:00:00+01:00" pubdate>2012-05-14</time>
    <address class="vcard author">
      by <a class="url fn" href="/False">Paul Agapow</a>
    </address>
  in <a href="/programming/">programming</a>
<p class="tags">tagged <a href="//by-tag/django/">django</a>, <a href="//by-tag/web-development/">web-development</a>, <a href="//by-tag/programming/">programming</a></p></div>
		<div class="summary">A pointer on how to process them.</div>


      <p>Django's form generation machinery for the most part is fine and
straightforward, but on a recent project I ran into problems with a form
that accepted files. The documentation is all there, but changes in how
things work and an emphasis on forms for models make things harder to
understand than they should be.</p>
<p>First, lets look at the form:</p>
<pre class="literal-block">
class MyForm(forms.Form):
   myfile = forms.FileField() # ...
</pre>
<p>and the <em>original</em> code for handling it:</p>
<pre class="literal-block">
def show_form (cls, request):
   # instantiate form in one of several ways ...
   form_cls = cls.MyForm
   # if the form has been submitted ...
   if request.method == 'POST':
      form = form_cls(request.POST)
   # if the form is valid
   if form.is_valid():
      # get the clean data and do the work
      cls.process_form (form.cleaned_data)
   else:
      # if you're coming to the form anew, make an unbound form
      form = form_cls()
      render_to_response('myform.html', {'form': form })
</pre>
<p>When the form is instantiated, it looks fine. But when it is submitted,
the validation always fails on the file field, saying the file is
required, whether or not a file has been selected in the form.</p>
<p>Strange. The field is, by default, required so a file needed but is not
being detected. By tracking the validation, we can see that it is
working correctly.</p>
<p>The answer is that files are now stored in the request apart from the
rest of the data in <tt class="docutils literal">request.FILES</tt>. This has to be passed to the form
c'tor:</p>
<pre class="literal-block">
if request.method == 'POST':
   form = form_cls(request.POST, request.FILES)
</pre>
<p>at which point the validation passes. After validation the file can be
found in the clean data as an <tt class="docutils literal">UploadedFile</tt> object.</p>


	</article>

    <p>
	<a href="https://twitter.com/share" class="twitter-share-button" data-via="" data-lang="en" data-size="large" data-related="">Tweet</a>
	<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
	</p>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'agapow';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

		  </div>

		  <div class="sidebar">
		    <div class="sidebar-container" >


	            <aside>
	              <h2>About</h2>
			      <p class='summary'>
                  This site has just been restored, with most of the content
						translated automatically from its old form. Expect bugs,
						missing information and general wierdness as things
						get sorted out.
			      </p>
			    </aside>


  	          <nav>
	            <h2>Categories</h2>
	            <ul>
	                <li ><a href="/misc/">misc</a></li>
	                <li ><a href="/personal/">personal</a></li>
	                <li class="active"><a href="/programming/">programming</a></li>
	                <li ><a href="/publications/">publications</a></li>
	                <li ><a href="/science/">science</a></li>
	                <li ><a href="/software/">software</a></li>
	                <li ><a href="/talks/">talks</a></li>
	            </ul>

	            <ul>
	              <li><a href="/tags.html">all tags</a></li>
	            </ul>
	          </nav>

	            <aside>
	            <h2>Social</h2>
			      <ul class="social">
				    <li><a href="http://twitter.com/agapow">Twitter</a><i></i></li>
				    <li><a href="http://github.com/agapow">Github</a><i></i></li>
				    <li><a href="https://plus.google.com/u/0/113920832845886210876/posts">Google+</a><i></i></li>
				    <li><a href="http://uk.linkedin.com/pub/paul-michael-agapow/2/15b/184/">linkedIn</a><i></i></li>
			      </ul>
			    </aside>

	            <aside>
	              <h2>Links</h2>
	              <ul>
	                  <li><a href="http://www.imperial.ac.uk/data-science/">IC Data Science Institute</a></li>
	                  <li><a href="http://www.meetup.com/Bioinformatics-London">Bioinformatics London</a></li>
	              </ul>
	            </aside>

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/agapow" data-widget-id="336428520026812416">Tweets by @agapow</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

	        </div>
		  </div>

	  </div>

      <footer>
		<p role="contentinfo">
		  Paul Agapow - Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>. Theme <a href="https://github.com/fle/pelican-sober">pelican-sober</a>.
    	</p>

	  </footer>

	</div>


</body>
</html>